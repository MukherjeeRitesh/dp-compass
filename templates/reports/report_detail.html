{% extends 'base.html' %}

{% block title %}{{ report.title }} - DP-COMPASS{% endblock %}
{% block page_title %}Report Details{% endblock %}

{% block content %}
<div class="row g-4">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">{{ report.title }}</h2>
                <span
                    class="badge badge-{% if report.status == 'approved' %}success{% elif report.status == 'generated' %}info{% else %}warning{% endif %}">
                    {{ report.get_status_display }}
                </span>
            </div>

            <div class="mb-4">
                <strong>Application:</strong>
                <a href="{% url 'application_detail' report.audit.application.pk %}"
                    style="color: var(--primary-light);">
                    {{ report.audit.application.name }}
                </a>
            </div>

            <div class="mb-4">
                <strong>Summary:</strong>
                <p style="color: var(--text-muted);">{{ report.summary|default:"No summary provided" }}</p>
            </div>

            {% if report.recommendations %}
            <div class="mb-4">
                <strong>Recommendations:</strong>
                <p style="color: var(--text-muted);">{{ report.recommendations }}</p>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="col-lg-4">
        <div class="card mb-4">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="bi bi-info-circle me-2"></i>
                    Report Info
                </h2>
            </div>

            <div style="display: flex; flex-direction: column; gap: 12px;">
                <div style="display: flex; justify-content: space-between;">
                    <span style="color: var(--text-muted);">Generated By</span>
                    <span>{{ report.generated_by.get_full_name|default:report.generated_by.username }}</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span style="color: var(--text-muted);">Generated</span>
                    <span>{{ report.generated_at|date:"M d, Y H:i" }}</span>
                </div>
                {% if report.approved_by %}
                <div style="display: flex; justify-content: space-between;">
                    <span style="color: var(--text-muted);">Approved By</span>
                    <span>{{ report.approved_by.get_full_name }}</span>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="bi bi-lightning me-2"></i>
                    Actions
                </h2>
            </div>

            <div style="display: flex; flex-direction: column; gap: 8px;">
                <a href="{% url 'report_export_pdf' report.pk %}" class="btn btn-primary w-100">
                    <i class="bi bi-download"></i>
                    Export Report
                </a>
                {% if user.is_admin_user and report.status != 'approved' %}
                <a href="{% url 'report_approve' report.pk %}" class="btn btn-success w-100">
                    <i class="bi bi-check-circle"></i>
                    Approve Report
                </a>
                {% endif %}
                <a href="{% url 'report_list' %}" class="btn btn-secondary w-100">
                    <i class="bi bi-arrow-left"></i>
                    Back to List
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}